defaultTasks 'clean', 'jekyllBuild', 'staticoOptimize'
buildscript {
    repositories {
        mavenCentral()
        mavenLocal()
    }
    dependencies {
        classpath 'io.staticcdn.sdk:staticcdn-sdk-gradle-plugin:0.1.15'
    }
}


task dev() dependsOn 'jekyllWatch'
task release() dependsOn 'clean', 'jekyllBuild', 'staticoOptimize', 'uploadFilesToS3'


task clean(type: Delete) {
    delete project.buildDir
}

task jekyllBuild(type: JekyllBuildTask)

task jekyllWatch(type: JekyllWatchTask)

task staticoOptimize(type: io.staticcdn.sdk.gradle.OptimizeTask) {
    config = [
            inputWwwRoots        : ['build/jekyll-generated-site/'],
            outputWwwRoot        : 'build/statico-optimized-files/',
            inputFilePathPatterns: [
                    '^.*index.html$',
            ]
    ]
}

task uploadFilesToS3(type: io.staticcdn.sdk.gradle.S3Task) {
    bucketName='www-statico-io'
    inputFolders=['build/statico-optimized-files/','build/jekyll-generated-site/']
    inputFilePathPatterns=['.*index.html$','/sitemap.xml']
}